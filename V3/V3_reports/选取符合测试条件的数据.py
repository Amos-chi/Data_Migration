import json
from datetime import datetime

import requests

from V3 import getAuthorization

proxies = {
    'http': 'http://127.0.0.1:4780',
    'https': 'http://127.0.0.1:4780'
}
def getV1Datas():
    header = {'Authorization': 'Bearer 49470e83-1471-46c6-878e-9c87ca76225f',
              'Cookie': 'JSESSIONID=e8800732-d6b2-4d35-9d6d-414b4b0d60a1; JSESSIONID=e8800732-d6b2-4d35-9d6d-414b4b0d60a1'
              }

    url = 'https://api.hitalentech.com/api/v1/report/pipeline/details'
    payload = {"activityId":"258234,258235,258237,258238,258239,258241,258242,258250,258256,258257,258258,258260,258273,258275,258277,258279,258280,258281,258282,258283,258286,258288,258289,258293,258294,258298,258299,258300,258302,258305,258306,258308,258312,258316,258320,258322,258324,258325,258327,258328,258332,258333,258334,258348,258350,258351,258352,258355,258359,258361,258363,258365,258366,258372,258375,258377,258378,258380,258381,258385,258386,258388,258389,258390,258395,258396,258401,258404,258406,258408,258409,258410,258414,258423,258424,258428,258429,258435,258437,258439,258440,258442,258443,258444,258446,258447,258448,258451,258452,258453,258456,258458,258459,258460,258462,258463,258464,258467,258468,258487,258489,258490,258492,258495,258496,258498,258499,258500,258501,258502,258507,258510,258524,258525,258526,258527,258528,258529,258545,258546,258557,258558,258559,258560,258564,258565,258566,258567,258568,258569,258571,258573,258574,258579,258581,258583,258585,258586,258588,258599,258602,258604,258605,258606,258607,258608,258610,258611,258612,258613,258614,258615,258616,258635,258637,258638,258639,258641,258650,258658,258660,258661,258662,258663,258664,258665,258666,258667,258668,258672,258674,258675,258677,258678,258680,258682,258684,258685,258686,258687,258688,258689,258690,258691,258692,258693,258694,258695,258696,258700,258701,258718,258725,258726,258727,258730,258734,258738,258750,258752,258753,258754,258756,258757,258759,258761,258765,258766,258768,258770,258771,258774,258775,258776,258777,258778,258789,258791,258793,258795,258798,258799,258800,258802,258803,258804,258805,258806,258807,258808,258809,258811,258812,258817,258818,258819,258820,258824,258827,258830,258831,258836,258837,258854,258861,258865,258867,258868,258873,258874,258877,258878,258879,258880,258881,258883,258884,258886,258888,258889,258890,258891,258892,258893,258894,258916,258918,258920,258921,258922,258923,258924,258926,258928,258930,258933,258935,258936,258942,258946,258947,258949,258951,258952,258953,258954,258955,258958,258975,258976,258977,258978,258980,258981,258982,258983,258985,258987,258989,258995,258997,258998,259002,259003,259005,259006,259007,259008,259009,259011,259012,259013,259014,259015,259019,259022,259024,259026,259042,259043,259044,259045,259047,259050,259051,259052,259057,259058,259060,259062,259064","size":10000,"timeZone":"Asia/Shanghai"}

    resp = requests.post(url, json= payload, headers= header , proxies = proxies)
    aa = resp.json()
    prod = []
    for j in resp.json():
        if datetime.strptime(j['latestActivityDate'],'%m/%d/%Y %H:%M:%S') < datetime.strptime("2022-09-20T00:00:00Z", '%Y-%m-%dT%H:%M:%SZ'):
            enu = {
                'activityId' : 'activityId',
                'candidate' : 'talentName',
                'sourcer' : 'appliedBy',
                'company' : 'company',
                'jobTitle' : 'title',
                'currentStatus' : 'activityStatusDesc',
                'lastUpdatedBy' : 'latestActivityUpdatedBy',
                'lastUpdatedAt' : 'latestActivityDate',
                'dateofSubmittedToAM' : 'appliedDate',
                'jobStatus' : 'status',
                'jobid' : 'jobId',
                'clientJobCode' : 'code',
                'hiringManager' : 'hiringManager'
            }
            dic_ = {}
            for key in enu.keys():
                if j.get(enu[key]):
                    dic_[key] = j[enu[key]]

            prod.append(dic_)
            f = open('prod.py', 'w', encoding= 'utf-8')
            f.write('prod = \n')
            f.write(json.dumps(prod, indent=4))

def getV2Datas():
    Authorization = getAuthorization.get_Authorization()
    header = {'Authorization': Authorization}
    url = 'https://api-staging.hitalentech.com:8888/report/api/v3/report/pipeline/details'

    ids = [117968,118142,118269,118270,118271,118272,118273,118274,118275,118276,118277,118278,118279,118280,118281,118282,118283,118284,118285,118286,118286,118287,118288,118289,118290,118291,118292,118293,118294,118295,118296,118297,118298,118299,118300,118300,118301,118302,118303,118304,118305,118306,118307,118308,118309,118310,118311,118312,118313,118314,118315,118316,118317,118318,118319,118320,118321,118321,118322,118323,118324,118325,118326,118327,118328,118328,118329,118330,118331,118332,118333,118334,118335,118336,118337,118338,118339,118340,118341,118342,118343,118344,118345,118346,118347,118348,118349,118350,118351,118352,118353,118354,118355,118356,118357,118358,118359,118360,118361,118362,118363,118364,118365,118366,118367,118368,118369,118370,118371,118372,118373,118374,118375,118376,118377,118378,118379,118380,118381,118382,118383,118384,118385,118386,118387,118388,118389,118390,118391,118392,118394,118395,118396,118397,118398,118399,118400,118401,118402,118403,118404,118405,118406,118407,118408,118409,118410,118411,118412,118413,118414,118415,118416,118417,118418,118419,118420,118421,118422,118423,118424,118425,118426,118427,118428,118429,118430,118431,118432,118433,118434,118435,118436,118437,118438,118439,118440,118441,118442,118443,118444,118445,118446,118447,118448,118449,118450,118451,118452,118453,118454,118455,118456,118457,118458,118459,118460,118461,118462,118463,118464,118465,118466,118467,118468,118469,118470,118471,118472,118473,118474,118475,118476,118477,118478,118479,118480,118481,118482,118483,118484,118485,118486,118487,118488,118489,118490,118491,118492,118493,118494,118495,118496,118497,118498,118499,118500,118501,118502,118503,118504,118505,118506,118507,118508,118509,118510,118511,118512,118513,118514,118515,118516,118517,118518,118519,118520,118521,118522,118523,118524,118525,118526,118527,118528,118529,118530,118531,118532,118533,118534,118535,118536,118537,118538,118539,118540,118541,118542,118543,118544,118545,118546,118547,118548]
    ids1 = []

    import prod
    prod_ = prod.prod

    p1 = []
    for j in prod_:
        if j['activityId'] in ids:
            p1.append(j)
            ids1.append(j['activityId'])

    cc = ','.join(ids1)
    payload = {"activityId": cc , "size": 10000, "timeZone": "Asia/Shanghai", "status": "SUBMIT_TO_JOB"}
    resp = requests.post(url, json= payload, headers= header, proxies = proxies)
    print(resp.json())

    prod = []
    for j in resp.json():
        enu = {
            'activityId': 'applicationId',
            'candidate': 'talentName',
            'sourcer': 'sourcer',
            'company': 'company',
            'jobTitle': 'jobTitle',
            'currentStatus': 'currentStatus',
            'lastUpdatedBy': 'lastUpdatedBy',
            'lastUpdatedAt': 'lastUpdatedAt',
            'dateofSubmittedToAM': 'activityCreatedDate',
            'jobStatus': 'jobStatus',
            'jobid': 'jobId',
            'clientJobCode': 'jobCode',
            'hiringManager': 'hiringManager'
        }
        dic_ = {}
        for key in enu.keys():
            if j.get(enu[key]):
                dic_[key] = j[enu[key]]

        prod.append(dic_)
        f = open('stag.py', 'w', encoding='utf-8')
        f.write(json.dumps(prod, indent=4))



if __name__ == '__main__':
    getV2Datas()